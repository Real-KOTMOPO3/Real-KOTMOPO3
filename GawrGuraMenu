local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- Создаём GUI меню
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = game.CoreGui

local MainFrame = Instance.new("ImageLabel")
MainFrame.Size = UDim2.new(0, 300, 0, 370)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -185)
MainFrame.Image = "rbxassetid://118184980762595"
MainFrame.BackgroundTransparency = 1
MainFrame.Parent = ScreenGui
MainFrame.Visible = false

-- Скруглённые углы для менюшки
local FrameCorner = Instance.new("UICorner")
FrameCorner.CornerRadius = UDim.new(0, 20)
FrameCorner.Parent = MainFrame

local ToggleButton = Instance.new("TextButton")
ToggleButton.Size = UDim2.new(0, 100, 0, 40)
ToggleButton.Position = UDim2.new(0, 75, 0, 10)
ToggleButton.Text = "Aimbot: OFF"
ToggleButton.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.Parent = MainFrame

local IgnoreFriendsButton = Instance.new("TextButton")
IgnoreFriendsButton.Size = UDim2.new(0, 200, 0, 40)
IgnoreFriendsButton.Position = UDim2.new(0, 25, 0, 60)
IgnoreFriendsButton.Text = "Игнорировать друзей: ВЫКЛ"
IgnoreFriendsButton.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
IgnoreFriendsButton.TextColor3 = Color3.fromRGB(255, 255, 255)
IgnoreFriendsButton.Parent = MainFrame

-- Проверка на видимость
local VisibilityCheckEnabled = false

local VisibilityButton = Instance.new("TextButton")
VisibilityButton.Size = UDim2.new(0, 200, 0, 40)
VisibilityButton.Position = UDim2.new(0, 25, 0, 190)
VisibilityButton.Text = "Проверка на видимость: ВЫКЛ"
VisibilityButton.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
VisibilityButton.TextColor3 = Color3.fromRGB(255, 255, 255)
VisibilityButton.Parent = MainFrame
-- Радиус Aimbot'а
local AimbotRadius = 100

local RadiusLabel = Instance.new("TextLabel")
RadiusLabel.Size = UDim2.new(0, 200, 0, 30)
RadiusLabel.Position = UDim2.new(0.5, 0, 1, -60)
RadiusLabel.Text = "Радиус Aimbot: 100"
RadiusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
RadiusLabel.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
RadiusLabel.BackgroundTransparency = 0.2
RadiusLabel.TextScaled = true
RadiusLabel.Parent = MainFrame

local RadiusBox = Instance.new("TextBox")
RadiusBox.Size = UDim2.new(0, 200, 0, 30)
RadiusBox.Position = UDim2.new(0.5, 0, 1, -30)
RadiusBox.Text = tostring(AimbotRadius)
RadiusBox.TextColor3 = Color3.fromRGB(255, 255, 255)
RadiusBox.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
RadiusBox.TextScaled = true
RadiusBox.ClearTextOnFocus = false
RadiusBox.Parent = MainFrame

RadiusBox.FocusLost:Connect(function()
    local val = tonumber(RadiusBox.Text)
    if val then
        AimbotRadius = val
        RadiusLabel.Text = "Радиус Aimbot: " .. val
    else
        RadiusBox.Text = tostring(AimbotRadius)
    end
end)

VisibilityButton.MouseButton1Click:Connect(function()
    VisibilityCheckEnabled = not VisibilityCheckEnabled
    VisibilityButton.Text = "Проверка на видимость: " .. (VisibilityCheckEnabled and "ВКЛ" or "ВЫКЛ")

    game.StarterGui:SetCore("SendNotification", {
        Title = "Gawr Gura Menu";
        Text = VisibilityCheckEnabled and "Проверка на видимость ON\nВы не можете целиться сквозь стены"
            or "Проверка на видимость OFF\nВы можете целиться сквозь стены";
        Icon = "rbxassetid://1234567890"; -- замени ID на нужный
        Duration = 5;
    })
end)

-- Ярлык "Коррекция"
local CorrectionLabel = Instance.new("TextLabel")
CorrectionLabel.Size = UDim2.new(0, 200, 0, 30)
CorrectionLabel.Position = UDim2.new(0, 25, 0, 110)
CorrectionLabel.Text = "Коррекция: 0"
CorrectionLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
CorrectionLabel.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
CorrectionLabel.BackgroundTransparency = 0.2
CorrectionLabel.TextScaled = true
CorrectionLabel.Parent = MainFrame

local LabelCorner = Instance.new("UICorner")
LabelCorner.CornerRadius = UDim.new(0, 10)
LabelCorner.Parent = CorrectionLabel

-- Поле для коррекции
local CorrectionSlider = Instance.new("TextBox")
CorrectionSlider.Size = UDim2.new(0, 200, 0, 40)
CorrectionSlider.Position = UDim2.new(0, 25, 0, 150)
CorrectionSlider.Text = "0"
CorrectionSlider.TextColor3 = Color3.fromRGB(255, 255, 255)
CorrectionSlider.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
CorrectionSlider.TextStrokeTransparency = 0.2
CorrectionSlider.TextStrokeColor3 = Color3.fromRGB(30, 60, 90)
CorrectionSlider.TextXAlignment = Enum.TextXAlignment.Center
CorrectionSlider.TextYAlignment = Enum.TextYAlignment.Center
CorrectionSlider.ClearTextOnFocus = false
CorrectionSlider.TextScaled = true
CorrectionSlider.Parent = MainFrame

local SliderCorner = Instance.new("UICorner")
SliderCorner.CornerRadius = UDim.new(0, 10)
SliderCorner.Parent = CorrectionSlider

-- Кнопка "Закрыть"
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 100, 0, 30)
CloseButton.Position = UDim2.new(0, 75, 0, 200)
CloseButton.Text = "Закрыть"
CloseButton.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextScaled = true
CloseButton.Parent = MainFrame

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 10)
CloseCorner.Parent = CloseButton

local CorrectionSlider = Instance.new("TextBox")
CorrectionSlider.Size = UDim2.new(0, 200, 0, 40)
CorrectionSlider.Position = UDim2.new(0, 25, 0, 150)
CorrectionSlider.Text = "0"
CorrectionSlider.TextColor3 = Color3.fromRGB(0, 0, 0)
CorrectionSlider.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
CorrectionSlider.Parent = MainFrame

local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 100, 0, 30)
CloseButton.Position = UDim2.new(0, 75, 0, 200)
CloseButton.Text = "Закрыть"
CloseButton.BackgroundColor3 = Color3.fromRGB(255, 69, 0)
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Parent = MainFrame

-- Текст внизу "Gawr Gura Menu"
local MenuLabel = Instance.new("TextLabel")
MenuLabel.Size = UDim2.new(1, 0, 0, 30)
MenuLabel.Position = UDim2.new(0.5, 0, 0, 10)
MenuLabel.Text = "Gawr Gura Menu"
MenuLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
MenuLabel.BackgroundTransparency = 1
MenuLabel.TextScaled = true
MenuLabel.Font = Enum.Font.SourceSansBold
MenuLabel.Parent = MainFrame

-- Голубая обводка текста
local UIStroke = Instance.new("UIStroke")
UIStroke.Thickness = 1.5
UIStroke.Color = Color3.fromRGB(70, 130, 180)
UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Contextual
UIStroke.Parent = MenuLabel

local AimbotEnabled = false
local IgnoreFriends = false
local BaseCorrection = 0

-- Функция поиска цели с учётом игнорирования друзей
local function GetBestTarget()
    local bestTarget = nil
    local shortestDistance = math.huge

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
            local head = player.Character.Head
            local distance = (head.Position - Camera.CFrame.Position).magnitude
            local screenPosition, onScreen = Camera:WorldToViewportPoint(head.Position)

            -- Проверка на друзей
            local isFriend = LocalPlayer:IsFriendsWith(player.UserId)
            if IgnoreFriends and isFriend then
                continue
            end

            -- Проверка видимости и приоритет ближайшего игрока
            if onScreen and distance < shortestDistance and distance <= AimbotRadius then
                local velocity = player.Character.PrimaryPart.Velocity * 0.1
                local predictedPosition = head.Position + velocity

                bestTarget = {player = player, position = predictedPosition, distance = distance}
                shortestDistance = distance
            end
        end
    end

    return bestTarget
end

-- Функция наведения на цель
RunService.RenderStepped:Connect(function()
    if AimbotEnabled then
        local targetData = GetBestTarget()
        if targetData then
            local targetPosition = targetData.position
            local distance = targetData.distance
            local heightCorrection = BaseCorrection * (distance / 50)
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetPosition - Vector3.new(0, heightCorrection, 0))
        end
    end
end)

-- Включение/выключение Aimbot
ToggleButton.MouseButton1Click:Connect(function()
    AimbotEnabled = not AimbotEnabled
    ToggleButton.Text = "Aimbot: " .. (AimbotEnabled and "ON" or "OFF")
end)

-- Включение/выключение игнорирования друзей
IgnoreFriendsButton.MouseButton1Click:Connect(function()
    IgnoreFriends = not IgnoreFriends
    IgnoreFriendsButton.Text = "Игнорировать друзей: " .. (IgnoreFriends and "ВКЛ" or "ВЫКЛ")
end)

-- Изменение коррекции высоты
CorrectionSlider.FocusLost:Connect(function()
    local newValue = tonumber(CorrectionSlider.Text)
    if newValue then
        BaseCorrection = newValue
        CorrectionLabel.Text = "Коррекция: " .. newValue
    else
        CorrectionSlider.Text = tostring(BaseCorrection)
    end
end)

-- Закрытие меню
CloseButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
end)

-- Кнопка для открытия меню (изображение с круглыми углами)
local OpenMenuButton = Instance.new("ImageButton")
OpenMenuButton.Size = UDim2.new(0, 80, 0, 80)
OpenMenuButton.Position = UDim2.new(0, 20, 0.5, -40)
OpenMenuButton.Image = "rbxassetid://84923457357901"
OpenMenuButton.BackgroundTransparency = 1
OpenMenuButton.Parent = ScreenGui

-- Скруглённые углы
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 20)
UICorner.Parent = OpenMenuButton

OpenMenuButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
end)

-- Перетаскивание кнопки открытия меню
local dragging = false
local dragInput, dragStart, startPos

local function updateInput(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
		local delta = input.Position - dragStart
		OpenMenuButton.Position = UDim2.new(
			0, startPos.X.Offset + delta.X,
			0, startPos.Y.Offset + delta.Y
		)
	end
end

OpenMenuButton.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = OpenMenuButton.Position

		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

OpenMenuButton.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
		dragInput = input
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		updateInput(input)
	end
end)
